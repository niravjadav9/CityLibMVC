@* ViewBag.BranchList *@

@{ 
    var branchList = new List<SelectListItem>();
    //var item = new List<Liberary_Management.Models.Top10BorrowerViewModel>();

    foreach (var item in ViewBag.BranchList)
    {
        branchList.Add(new SelectListItem {
            Text = item.name,
            Value = item.branchid.ToString()
        });
    }
}

<div class="row">
    <div class="form-group">
        <label for="Branch">Branches: </label>
        @Html.DropDownList("Branch", branchList, new { @id = "drpBranches", @class = "form-control" })
    </div>
</div>

<div id="displayTable">
    <table id="tblDisplayResult" class="table table-striped"></table>
</div>

<script>
    $("#drpBranches").change(function () {
        debugger;
        var branchId = parseInt($(this).val());
        var siteURL = "@Url.Action("Top10BrrowerList", "AdminFunction")";
        var strData = { branchid: branchId };

        function callbackSuccess (response) {
            debugger;
            $('#tblDisplayResult').html('');
            var data = JSON.parse(response);
            if (data.length > 0) {
                $(function () {
                    var $th = $('<tr>').append(
                        $('<th>').text('Reader Name'),
                        $('<th>').text('Total Books')
                    ).appendTo('#tblDisplayResult');
                    console.log(`Response:  ${data}`);

                    $.each(data, function (i, item) {
                        var $tr = $('<tr>').append(
                            $('<td>').text(item.readerName),
                            $('<td>').text(item.totalBook)
                        ).appendTo('#tblDisplayResult');
                    });
                });
            } else {
                $(function () {
                    $('#divResult').html('<h1>No Records Found!</h1>');
                });
            }
        }

        function callbackError (x, y, z) {
            console.error(`Error found at $("#drpBranches").change(function () { });. \n ${JSON.stringify(x)}  \n ${y} \n ${z}`);
        }

        ajaxGet(siteURL, strData, callbackSuccess);

        //ajaxPOST(strSiteURL, strData, callbackSuccess, 'Top 10 most borrower', callbackError);
    });
</script>